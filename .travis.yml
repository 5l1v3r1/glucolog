matrix:
  include:
    - php: 7.2
      env:
        - TO_TEST=FRONTEND
        - APP_ENV=testing
        - APP_KEY=SomeRandomString
        - DB_CONNECTION=mysql
        - DB_HOST=127.0.0.1
        - DB_PORT=3306
        - DB_DATABASE=glucolog_test
        - DB_USERNAME=root
        - DB_PASSWORD=

    - python: 3.7
      env:
        - FLASK_ENV=development
        - API_VERSION=1
        - CONFIG_FILE=testing.json
        - TESTING=1

before_install:
  - mysql -e 'CREATE DATABASE glucolog_test;'

install:
  - cd ./src/python3/
  - pip install -r requirements.txt

before_script:
  - cd ./src/python3/
  - python migrate.py db init
  - python migrate.py db upgrade
  - python migrate.py db migrate
  - python migrate.py seed
  - cd ./src/php7/
  - cp .env.travis .env
  - composer self-update
  - composer install --prefer-source --no-interaction
  - php artisan key:generate
  - php artisan migrate
  - php artisan passport:install
  
script:
  - cd ./src/php7/
  - phpunit
  - cd ../../
  - cd ./src/python3/
  - python test.py

services:
  - mysql
